# AI 超级个体开发助手 v2.0 - 产品需求文档

> **版本**: v2.0
> **日期**: 2025-12-13
> **状态**: 需求确认中

---

## 一、产品愿景

### 1.1 一句话描述

**为超级个体提供从需求到部署的完整人机协作开发闭环。**

### 1.2 核心定位

| 维度 | 定义 |
|------|------|
| **产品类型** | 方法论 + 工具 + 规范 |
| **目标平台** | Claude CLI（专注） |
| **用户定位** | 一个人完成软件全流程的开发者 |
| **核心价值** | 人类主导决策，AI 执行产出，审核保证质量 |

### 1.3 与 v1.0 的区别

| 能力 | v1.0 | v2.0 |
|------|------|------|
| 项目初始化 | ✅ | ✅ |
| 需求分析 | ✅ (AI生成) | ✅ (AI生成 + 人类审核) |
| 架构设计 | ✅ (AI生成) | ✅ (AI生成 + 人类审核) |
| 代码实现 | ✅ (AI生成) | ✅ (AI生成 + 代码审查) |
| E2E测试 | ❌ | ✅ (新增) |
| 部署文档 | ❌ | ✅ (新增) |
| 审核机制 | ❌ | ✅ (新增，可跳过) |
| 变更管理 | ❌ | ✅ (新增) |
| 状态追踪 | 部分 | ✅ (完整闭环) |

---

## 二、目标用户

### 2.1 用户画像

```yaml
名称: 超级个体开发者

典型特征:
  - 一个人同时承担产品、研发、测试、运维角色
  - 有一定开发经验，熟悉至少一种技术栈
  - 使用 AI 辅助开发，但缺乏系统化方法
  - 追求效率，但不愿牺牲质量

典型场景:
  - 技术创业者开发 MVP
  - 独立开发者维护个人项目
  - 企业内部工具的单人开发

核心诉求:
  - 不遗漏关键步骤
  - 减少重复性工作
  - 保持产出质量
  - 随时掌握进度
```

### 2.2 用户痛点

| 痛点 | 描述 | 影响 | 解决方案 |
|------|------|------|----------|
| **P1: 流程断裂** | 从需求到上线没有完整的闭环 | 容易遗漏步骤，质量不稳定 | 定义完整的5阶段闭环 |
| **P2: AI产出不可控** | AI 生成内容没有审核机制 | 问题累积，后期返工 | 每阶段设置审核点 |
| **P3: 变更难追踪** | 需求变更后不知道影响范围 | 改漏、改错、重复工作 | 变更影响分析 + 自动追踪 |
| **P4: 状态不透明** | 不知道项目当前在什么阶段 | 焦虑、混乱、低效 | 实时状态追踪 |

---

## 三、功能架构

### 3.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         AI 超级个体开发助手 v2.0                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        人机协作层                                     │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐         │   │
│  │  │ 人类输入   │  │ AI 执行   │  │ 审核确认   │  │ 变更请求   │         │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        工作流引擎                                      │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐        │   │
│  │  │ 需求分析 │→│ 架构设计 │→│ 代码实现 │→│ E2E测试 │→│  部署   │        │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘        │   │
│  │       ↑                                               │              │   │
│  │       └────────────── 变更回退 ──────────────────────←┘              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        核心能力                                        │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐         │   │
│  │  │ 状态管理   │  │ 产物管理   │  │ 审核系统   │  │ 变更追踪   │         │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Skill 能力层                                    │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐       │   │
│  │  │ requirements-   │  │ architecture-   │  │ developer-     │       │   │
│  │  │ analyzer        │  │ designer        │  │ guide          │       │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘       │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐       │   │
│  │  │ test-planner    │  │ change-manager  │  │ reviewer        │       │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        数据层                                          │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐             │   │
│  │  │ state.json    │  │ *.yaml        │  │ db.sqlite     │             │   │
│  │  │ (项目状态)     │  │ (审核/变更)    │  │ (历史查询)     │             │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 模块划分

| 模块 | 职责 | 优先级 | 状态 |
|------|------|--------|------|
| **状态管理模块** | 项目状态追踪、阶段流转 | P0 | 新增 |
| **审核系统模块** | 审核清单、审核记录、反馈追踪 | P0 | 新增 |
| **变更管理模块** | 变更分析、影响追踪、回退机制 | P0 | 新增 |
| **CLI工具模块** | 命令行交互、指令处理 | P0 | 升级 |
| **Skills模块** | 专业AI能力封装 | P0 | 升级 |
| **模板库模块** | 项目模板管理 | P1 | 已有 |
| **文档生成模块** | PRD生成、图表渲染 | P1 | 已有 |

---

## 四、开发闭环详细设计

### 4.1 五阶段工作流

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              开发闭环                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  阶段1: 需求分析                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 人类输入: 想法、用户故事、草图                                         │   │
│  │ AI输出:  PRD、模块划分、用户故事、验收标准                              │   │
│  │ 审核点:  需求完整性、业务可行性                                         │   │
│  │ 产物:   docs/requirements/                                           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  阶段2: 架构设计                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 人类输入: 技术约束、偏好                                               │   │
│  │ AI输出:  架构图、技术选型、API设计、数据模型                            │   │
│  │ 审核点:  技术方案合理性                                                │   │
│  │ 产物:   docs/architecture/                                           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  阶段3: 代码实现                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 人类输入: 实现优先级                                                   │   │
│  │ AI输出:  源代码、单元测试、集成测试                                     │   │
│  │ 审核点:  代码审查                                                      │   │
│  │ 产物:   src/, tests/unit/, tests/integration/                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  阶段4: E2E测试                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 人类输入: 核心场景确认                                                 │   │
│  │ AI输出:  E2E测试代码、测试报告                                         │   │
│  │ 审核点:  测试覆盖率、场景完整性                                         │   │
│  │ 产物:   tests/e2e/                                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  阶段5: 部署                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 人类输入: 目标环境                                                     │   │
│  │ AI输出:  部署文档、CI/CD配置、运维手册                                  │   │
│  │ 审核点:  部署方案确认                                                  │   │
│  │ 产物:   deploy/, .github/workflows/                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 阶段状态机

每个阶段内部的状态流转：

```
pending → generating → reviewing → approved/needs_revision
                          ↓
                    (修改后重新 generating)
```

| 状态 | 说明 | 触发条件 |
|------|------|----------|
| `pending` | 待开始 | 前一阶段完成 |
| `generating` | 生成中 | AI 正在工作 |
| `reviewing` | 待审核 | AI 产出完成 |
| `approved` | 已通过 | 人类确认通过 |
| `needs_revision` | 需修改 | 人类提出修改意见 |
| `skipped` | 已跳过 | 人类选择跳过审核 |

### 4.3 产物目录结构

```
project-root/
├── .ai-dev/                      # 状态和配置
│   ├── state.json                # 项目状态
│   ├── config.yaml               # 项目配置
│   ├── reviews/                  # 审核记录
│   │   ├── 2025-12-13-requirements.yaml
│   │   └── 2025-12-13-architecture.yaml
│   └── changes/                  # 变更记录
│       └── CR-001.yaml
│
├── docs/                         # 文档产物
│   ├── requirements/             # 需求文档
│   │   ├── 00-项目概览.md
│   │   ├── 01-模块划分.md
│   │   ├── 02-用户故事.md
│   │   └── modules/
│   │       └── {module}/
│   │           ├── 03-核心流程.md
│   │           └── 05-验收标准.md
│   │
│   ├── architecture/             # 架构文档
│   │   ├── 01-架构概览.md
│   │   ├── 02-技术选型.md
│   │   ├── 03-模块设计.md
│   │   ├── 04-数据模型.md
│   │   └── 05-API设计.md
│   │
│   └── deploy/                   # 部署文档
│       ├── 01-环境配置.md
│       ├── 02-部署流程.md
│       └── 03-运维手册.md
│
├── src/                          # 源代码
│   └── modules/
│
├── tests/                        # 测试
│   ├── unit/
│   ├── integration/
│   └── e2e/
│
└── deploy/                       # 部署配置
    ├── docker/
    └── k8s/
```

---

## 五、用户故事清单

### 5.1 状态管理 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-101 | 作为超级个体，我想查看项目当前状态，以便知道下一步做什么 | 显示当前阶段、进度百分比、待办事项 |
| US-102 | 作为超级个体，我想看到各阶段的完成情况 | 显示5个阶段的状态（待开始/进行中/已完成） |
| US-103 | 作为超级个体，我想知道当前阶段的阻塞项 | 列出缺失的产物或待审核项 |

### 5.2 需求分析 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-201 | 作为超级个体，我想输入想法让 AI 生成需求文档 | 生成 PRD、模块划分、用户故事 |
| US-202 | 作为超级个体，我想审核需求文档并提出修改 | 可以标记通过/需修改，修改意见被记录 |
| US-203 | 作为超级个体，我想跳过需求审核直接进入下一阶段 | 标记为 skipped，允许继续 |

### 5.3 架构设计 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-301 | 作为超级个体，我想让 AI 基于需求生成架构设计 | 生成架构图、技术选型、API设计、数据模型 |
| US-302 | 作为超级个体，我想审核架构并确认技术选型 | 可以标记通过/需修改 |
| US-303 | 作为超级个体，我想在架构设计时指定技术约束 | 约束被 AI 遵守 |

### 5.4 代码实现 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-401 | 作为超级个体，我想让 AI 按模块生成代码 | 生成符合架构的代码 |
| US-402 | 作为超级个体，我想让 AI 同时生成单元测试 | 单元测试覆盖核心逻辑 |
| US-403 | 作为超级个体，我想审查 AI 生成的代码 | 可以标记通过/需修改 |
| US-404 | 作为超级个体，我想让 AI 生成集成测试 | 集成测试覆盖模块交互 |

### 5.5 E2E测试 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-501 | 作为超级个体，我想让 AI 基于验收标准生成 E2E 测试 | E2E 测试覆盖验收场景 |
| US-502 | 作为超级个体，我想审核 E2E 测试覆盖率 | 显示覆盖的验收标准 |
| US-503 | 作为超级个体，我想运行 E2E 测试并查看结果 | 测试报告清晰 |

### 5.6 部署 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-601 | 作为超级个体，我想让 AI 生成部署文档 | 包含环境配置、部署流程 |
| US-602 | 作为超级个体，我想让 AI 生成 CI/CD 配置 | GitHub Actions 或其他 CI 配置 |
| US-603 | 作为超级个体，我想审核部署方案 | 可以标记通过/需修改 |

### 5.7 变更管理 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-701 | 作为超级个体，我想在任意阶段发起需求变更 | 变更请求被记录 |
| US-702 | 作为超级个体，我想看到变更的影响分析 | 显示受影响的模块、文档、代码 |
| US-703 | 作为超级个体，我想确认后执行变更回退 | 项目回退到正确阶段 |
| US-704 | 作为超级个体，我想查看变更历史 | 所有变更记录可查询 |

### 5.8 审核系统 (P0)

| ID | 用户故事 | 验收标准 |
|----|----------|----------|
| US-801 | 作为超级个体，我想看到结构化的审核清单 | 每个阶段有对应清单 |
| US-802 | 作为超级个体，我想记录审核意见 | 意见被保存 |
| US-803 | 作为超级个体，我想查看历史审核记录 | 所有审核记录可查询 |

---

## 六、命令设计

### 6.1 核心命令

```bash
# 状态查看
/status                    # 查看项目当前状态
/status requirements       # 查看需求阶段状态

# 阶段推进
/next                      # 进入下一步（AI判断）
/goto architecture         # 跳转到指定阶段

# 审核
/review                    # 审核当前阶段产物
/review --skip             # 跳过审核
/review --feedback "xxx"   # 提交修改意见

# 变更
/change "描述"             # 发起变更请求
/change --analyze          # 分析当前变更影响
/change --execute          # 执行变更
/change --history          # 查看变更历史

# 帮助
/help                      # 查看帮助
```

### 6.2 命令交互示例

```
用户: /status

AI: 📊 项目状态

    当前阶段: 代码实现 (60%)

    ┌──────────┬──────────┬──────────┬──────────┬──────────┐
    │ 需求分析  │ 架构设计  │ 代码实现  │ E2E测试  │   部署   │
    │   ✅     │   ✅     │   🔄     │   ⏳     │   ⏳    │
    └──────────┴──────────┴──────────┴──────────┴──────────┘

    待办事项:
    1. [ ] 完成用户模块代码 (in progress)
    2. [ ] 完成订单模块代码
    3. [ ] 集成测试

    下一步建议: 继续用户模块开发
```

---

## 七、数据模型

### 7.1 项目状态 (state.json)

```json
{
  "version": "2.0",
  "projectName": "my-app",
  "createdAt": "2025-12-13T10:00:00Z",
  "updatedAt": "2025-12-13T15:30:00Z",
  "currentPhase": "implementation",
  "phases": {
    "requirements": {
      "status": "approved",
      "startedAt": "2025-12-13T10:00:00Z",
      "completedAt": "2025-12-13T11:00:00Z",
      "artifacts": ["docs/requirements/00-项目概览.md", "..."],
      "reviewId": "REV-001"
    },
    "architecture": {
      "status": "approved",
      "startedAt": "2025-12-13T11:00:00Z",
      "completedAt": "2025-12-13T13:00:00Z",
      "artifacts": ["docs/architecture/01-架构概览.md", "..."],
      "reviewId": "REV-002"
    },
    "implementation": {
      "status": "generating",
      "startedAt": "2025-12-13T13:00:00Z",
      "progress": 60,
      "currentModule": "user"
    },
    "e2e_testing": {
      "status": "pending"
    },
    "deployment": {
      "status": "pending"
    }
  },
  "activeChangeRequest": null
}
```

### 7.2 审核记录 (reviews/*.yaml)

```yaml
# .ai-dev/reviews/REV-001.yaml
id: REV-001
phase: requirements
timestamp: 2025-12-13T11:00:00Z
result: approved
checklist:
  - item: "所有模块都有用户故事"
    checked: true
  - item: "所有用户故事都有验收标准"
    checked: true
  - item: "边界条件已考虑"
    checked: true
comments: "需求完整，可以进入架构设计"
revisions: []
```

### 7.3 变更记录 (changes/*.yaml)

```yaml
# .ai-dev/changes/CR-001.yaml
id: CR-001
timestamp: 2025-12-13T14:00:00Z
description: "订单模块需要支持分期付款"
sourcePhase: implementation
status: completed

impact:
  requirements:
    affected: true
    files: ["docs/requirements/modules/订单模块/03-核心流程.md"]
  architecture:
    affected: true
    files: ["docs/architecture/04-数据模型.md", "docs/architecture/05-API设计.md"]
  implementation:
    affected: true
    files: ["src/modules/order/*"]

execution:
  rolledBackTo: architecture
  executedAt: 2025-12-13T14:30:00Z
```

---

## 八、Skill 设计

### 8.1 Skill 清单

| Skill | 职责 | 状态 |
|-------|------|------|
| requirements-analyzer | 需求分析、PRD生成 | 升级 |
| architecture-designer | 架构设计、技术选型 | 升级 |
| developer-guide | 代码生成、代码审查 | 升级 |
| test-planner | 测试策略、E2E测试 | 升级 |
| change-manager | 变更分析、影响追踪 | 新增 |
| reviewer | 审核流程、清单管理 | 新增 |

### 8.2 Skill 输入输出

| Skill | 输入 | 输出 |
|-------|------|------|
| requirements-analyzer | 用户想法、约束 | PRD、模块划分、用户故事、验收标准 |
| architecture-designer | 需求文档、技术约束 | 架构图、技术选型、API、数据模型 |
| developer-guide | 架构+需求、优先级 | 源代码、单元测试、集成测试 |
| test-planner | 验收标准、代码 | E2E测试、测试报告 |
| change-manager | 变更描述 | 影响分析、回退计划 |
| reviewer | 产物清单 | 审核结果、修改建议 |

---

## 九、实现优先级

### Phase 1: MVP 闭环 (P0)

```yaml
目标: 跑通完整的5阶段闭环

功能:
  - 状态管理基础设施
  - 5阶段基本流转
  - 简单审核机制（通过/跳过）
  - /status, /next, /review 命令
  - 基于 JSON 的数据存储

验收标准:
  - 可以从需求走到部署
  - 每个阶段有明确状态
  - 审核可以通过或跳过
```

### Phase 2: 审核增强 (P0)

```yaml
目标: 完善审核体验

功能:
  - 结构化审核清单
  - 审核历史记录
  - 修改反馈追踪
  - YAML 格式审核记录

验收标准:
  - 每个阶段有对应清单
  - 历史审核可查询
```

### Phase 3: 变更管理 (P0)

```yaml
目标: 支持需求变更

功能:
  - 变更请求创建
  - 影响范围分析
  - 自动回退机制
  - 变更历史追踪

验收标准:
  - 变更影响可视化
  - 回退执行正确
```

### Phase 4: 体验优化 (P1)

```yaml
目标: 提升使用体验

功能:
  - 更好的状态可视化
  - 进度报告生成
  - SQLite 历史查询
  - 更多项目模板

验收标准:
  - 用户满意度提升
```

---

## 十、成功指标

### 10.1 产品指标

| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 项目完成率 | > 80% | 从需求到部署完整走完 |
| 审核通过率 | > 70% | 首次生成通过审核 |
| 变更处理成功率 | > 90% | 变更正确执行 |
| 用户操作次数 | < 50 | 完成一个项目的命令数 |

### 10.2 用户体验指标

| 指标 | 目标值 |
|------|--------|
| 上手时间 | < 10 分钟 |
| 完成首个项目 | < 2 小时 |
| NPS | > 50 |

---

## 附录

### A. 术语表

| 术语 | 定义 |
|------|------|
| 超级个体 | 一个人同时承担产品、研发、测试、运维角色的开发者 |
| 阶段 | 开发闭环中的一个步骤（需求/架构/实现/测试/部署） |
| 产物 | 每个阶段的输出文件 |
| 审核 | 人类对 AI 产出的确认过程 |
| 变更 | 对已确认内容的修改请求 |

### B. 相关文档

- [模块划分](../01-模块划分.md)
- [用户故事](../02-用户故事.md)
- [架构设计](../architecture/)

---

**文档版本**: v2.0
**创建日期**: 2025-12-13
**创建者**: AI 助手
**状态**: 待审核
