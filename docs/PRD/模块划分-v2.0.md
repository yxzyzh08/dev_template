# AI 超级个体开发助手 v2.0 - 模块划分

> **版本**: v2.0
> **日期**: 2025-12-13

---

## 一、模块全景图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              模块架构                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                          交互层                                       │   │
│   │  ┌─────────────────────────────────────────────────────────────┐    │   │
│   │  │                    CLI工具模块                                │    │   │
│   │  │  commands/ | prompts/ | ui/                                  │    │   │
│   │  └─────────────────────────────────────────────────────────────┘    │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                          核心业务层                                   │   │
│   │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │
│   │  │  状态管理模块   │  │  审核系统模块   │  │  变更管理模块   │            │   │
│   │  └───────────────┘  └────────────��──┘  └───────────────┘            │   │
│   │  ┌───────────────┐  ┌───────────────┐                               │   │
│   │  │  工作流引擎    │  │  产物管理模块   │                               │   │
│   │  └───────────────┘  └───────────────┘                               │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                          能力层                                       │   │
│   │  ┌─────────────────────────────────────────────────────────────┐    │   │
│   │  │                     Skills模块                                │    │   │
│   │  │  requirements | architecture | developer | test | change     │    │   │
│   │  └─────────────────────────────────────────────────────────────┘    │   │
│   │  ┌─────────────────────────────────────────────────────────────┐    │   │
│   │  │                    模板库模块                                  │    │   │
│   │  └─────────────────────────────────────────────────────────────┘    │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                          基础设施层                                   │   │
│   │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │
│   │  │  文件系统助手   │  │  Git 助手     │  │  配置管理     │            │   │
│   │  └───────────────┘  └───────────────┘  └───────────────┘            │   │
│   │  ┌───────────────────────────────────────────────────────────────┐  │   │
│   │  │                      数据存储                                   │  │   │
│   │  │              JSON | YAML | SQLite                              │  │   │
│   │  └───────────────────────────────────────────────────────────────┘  │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、模块详细说明

### 2.1 状态管理模块 (新增)

```yaml
模块名称: StateManager
职责: 管理项目状态和阶段流转
优先级: P0
状态: 新增

核心功能:
  - 项目状态读写
  - 阶段状态流转
  - 进度计算
  - 阻塞项检测

输入:
  - 状态变更请求
  - 阶段完成信号

输出:
  - 当前状态快照
  - 进度百分比
  - 待办事项列表

依赖:
  - 数据存储层 (state.json)

接口:
  - getState(): ProjectState
  - updatePhase(phase, status): void
  - getProgress(): number
  - getBlockers(): Blocker[]
```

### 2.2 审核系统模块 (新增)

```yaml
模块名称: ReviewSystem
职责: 管理审核流程和记录
优先级: P0
状态: 新增

核心功能:
  - 审核清单管理
  - 审核流程执行
  - 审核记录存储
  - 反馈追踪

输入:
  - 阶段产物
  - 审核结果
  - 修改意见

输出:
  - 审核清单
  - 审核状态
  - 历史记录

依赖:
  - 状态管理模块
  - 数据存储层 (reviews/*.yaml)

接口:
  - getChecklist(phase): Checklist
  - submitReview(result, comments): ReviewRecord
  - getReviewHistory(phase?): ReviewRecord[]
  - skipReview(phase): void
```

### 2.3 变更管理模块 (新增)

```yaml
模块名称: ChangeManager
职责: 管理需求变更和影响追踪
优先级: P0
状态: 新增

核心功能:
  - 变更请求创建
  - 影响范围分析
  - 回退计划生成
  - 变更执行
  - 历史追踪

输入:
  - 变更描述
  - 当前项目状态

输出:
  - 影响分析报告
  - 回退计划
  - 变更记录

依赖:
  - 状态管理模块
  - 产物管理模块
  - 数据存储层 (changes/*.yaml)

接口:
  - createChangeRequest(description): ChangeRequest
  - analyzeImpact(cr): ImpactAnalysis
  - executeChange(cr): void
  - getChangeHistory(): ChangeRequest[]
```

### 2.4 工作流引擎 (新增)

```yaml
模块名称: WorkflowEngine
职责: 编排和执行开发工作流
优先级: P0
状态: 新增

核心功能:
  - 阶段路由
  - 门禁校验
  - Skill 调度
  - 流程推进

输入:
  - 用户指令
  - 当前状态

输出:
  - 下一步建议
  - 执行结果

依赖:
  - 状态管理模块
  - Skills 模块
  - 审核系统模块

接口:
  - next(): PhaseAction
  - goto(phase): void
  - validateGate(phase): GateResult
  - invokeSkill(skillName, params): SkillResult
```

### 2.5 产物管理模块 (新增)

```yaml
模块名称: ArtifactManager
职责: 管理各阶段产物
优先级: P0
状态: 新增

核心功能:
  - 产物索引
  - 完整性校验
  - 依赖追踪
  - 产物查询

输入:
  - 产物路径
  - 校验请求

输出:
  - 产物清单
  - 完整性报告
  - 依赖图

依赖:
  - 文件系统助手

接口:
  - registerArtifact(path, phase): void
  - validateArtifacts(phase): ValidationResult
  - getArtifactsByPhase(phase): Artifact[]
  - getDependencies(artifact): Artifact[]
```

### 2.6 CLI工具模块 (升级)

```yaml
模块名称: CLI
职责: 命令行交互入口
优先级: P0
状态: 升级

新增功能:
  - /status 命令
  - /next 命令
  - /review 命令
  - /change 命令
  - /goto 命令

保留功能:
  - init 命令
  - generate-prd 命令
  - validate 命令

依赖:
  - 状态管理模块
  - 审核系统模块
  - 变更管理模块
  - 工作流引擎
```

### 2.7 Skills模块 (升级)

```yaml
模块名称: Skills
职责: AI 专业能力封装
优先级: P0
状态: 升级

现有 Skills:
  - requirements-analyzer (升级)
  - architecture-designer (升级)
  - developer-guide (升级)
  - test-planner (升级)

新增 Skills:
  - change-manager
  - reviewer

升级内容:
  - 增加状态感知
  - 增加审核集成
  - 增加变更响应
```

---

## 三、模块依赖关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              依赖关系图                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                           ┌─────────────┐                                   │
│                           │     CLI     │                                   │
│                           └──────┬──────┘                                   │
│                                  │                                          │
│            ┌─────────────────────┼─────────────────────┐                    │
│            │                     │                     │                    │
│            ▼                     ▼                     ▼                    │
│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐          │
│   │  WorkflowEngine │   │  ReviewSystem   │   │  ChangeManager  │          │
│   └────────┬────────┘   └────────┬────────┘   └────────┬────────┘          │
│            │                     │                     │                    │
│            └─────────────────────┼─────────────────────┘                    │
│                                  │                                          │
│                                  ▼                                          │
│                         ┌─────────────────┐                                 │
│                         │  StateManager   │                                 │
│                         └────────┬────────┘                                 │
│                                  │                                          │
│            ┌─────────────────────┼─────────────────────┐                    │
│            │                     │                     │                    │
│            ▼                     ▼                     ▼                    │
│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐          │
│   │ ArtifactManager │   │     Skills      │   │   Templates     │          │
│   └────────┬────────┘   └────────┬────────┘   └────────┬────────┘          │
│            │                     │                     │                    │
│            └─────────────────────┼─────────────────────┘                    │
│                                  │                                          │
│                                  ▼                                          │
│                     ┌──────────────────────────┐                            │
│                     │     Infrastructure       │                            │
│                     │  (FileSystem, Git, etc)  │                            │
│                     └──────────────────────────┘                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、模块边界定义

### 4.1 状态管理模块

**负责:**
- 项目状态的持久化和读取
- 阶段状态的流转
- 进度计算

**不负责:**
- ❌ 产物内容管理（由 ArtifactManager）
- ❌ 审核逻辑（由 ReviewSystem）
- ❌ 变更分析（由 ChangeManager）

### 4.2 审核系统模块

**负责:**
- 审核清单的定义和管理
- 审核结果的记录
- 审核历史的查询

**不负责:**
- ❌ 产物生成（由 Skills）
- ❌ 状态流转（由 StateManager）

### 4.3 变更管理模块

**负责:**
- 变更请求的创建和记录
- 影响范围的分析
- 回退操作的执行

**不负责:**
- ❌ 产物修改（由 Skills）
- ❌ 状态持久化（由 StateManager）

### 4.4 工作流引擎

**负责:**
- 工作流的编排和执行
- 阶段间的路由
- Skill 的调度

**不负责:**
- ❌ 具体产物生成（由 Skills）
- ❌ 状态持久化（由 StateManager）

---

## 五、目录结构

```
src/
├── core/                          # 核心业务层
│   ├── state/                     # 状态管理模块
│   │   ├── StateManager.ts
│   │   ├── PhaseState.ts
│   │   └── index.ts
│   │
│   ├── review/                    # 审核系统模块
│   │   ├── ReviewSystem.ts
│   │   ├── Checklist.ts
│   │   ├── ReviewRecord.ts
│   │   └── index.ts
│   │
│   ├── change/                    # 变更管理模块
│   │   ├── ChangeManager.ts
│   │   ├── ImpactAnalyzer.ts
│   │   ├── ChangeRequest.ts
│   │   └── index.ts
│   │
│   ├── workflow/                  # 工作流引擎
│   │   ├── WorkflowEngine.ts
│   │   ├── PhaseRouter.ts
│   │   ├── GateValidator.ts
│   │   └── index.ts
│   │
│   └── artifact/                  # 产物管理模块
│       ├── ArtifactManager.ts
│       ├── ArtifactIndex.ts
│       └── index.ts
│
├── cli/                           # CLI工具模块
│   ├── commands/
│   │   ├── status.ts              # 新增
│   │   ├── next.ts                # 新增
│   │   ├── review.ts              # 新增
│   │   ├── change.ts              # 新增
│   │   ├── init.ts
│   │   └── ...
│   ├── prompts/
│   └── ui/
│
├── skills/                        # Skills模块
│   ├── requirements-analyzer/
│   ├── architecture-designer/
│   ├── developer-guide/
│   ├── test-planner/
│   ├── change-manager/            # 新增
│   └── reviewer/                  # 新增
│
├── templates/                     # 模板库模块
│   └── ...
│
├── infrastructure/                # 基础设施层
│   ├── FileSystemHelper.ts
│   ├── GitHelper.ts
│   ├── storage/
│   │   ├── JsonStorage.ts
│   │   ├── YamlStorage.ts
│   │   └── SqliteStorage.ts       # 新增
│   └── index.ts
│
└── types/                         # 类型定义
    ├── state.ts                   # 新增
    ├── review.ts                  # 新增
    ├── change.ts                  # 新增
    └── index.ts
```

---

## 六、实现优先级

| 优先级 | 模块 | 说明 |
|--------|------|------|
| P0-1 | StateManager | 状态管理是一切的基础 |
| P0-2 | WorkflowEngine | 实现阶段流转 |
| P0-3 | CLI (status, next) | 基本交互 |
| P0-4 | ReviewSystem | 审核能力 |
| P0-5 | CLI (review) | 审核交互 |
| P0-6 | ChangeManager | 变更能力 |
| P0-7 | CLI (change) | 变更交互 |
| P1-1 | ArtifactManager | 产物管理增强 |
| P1-2 | Skills 升级 | 状态感知 |
| P2-1 | SqliteStorage | 历史查询 |

---

**文档版本**: v2.0
**创建日期**: 2025-12-13
