# æ¨¡å—è®¾è®¡

## æ–‡æ¡£ä¿¡æ¯
- **é¡¹ç›®åç§°**: AIè¶…çº§ä¸ªä½“å¼€å‘æ¨¡æ¿ç³»ç»Ÿ
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-12-10

---

## 1. æ¨¡å—æ¶æ„æ€»è§ˆ

### 1.1 æ¨¡å—åˆ’åˆ†åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªé¢†åŸŸ
- **ä½è€¦åˆ**ï¼šæ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡
- **é«˜å†…èš**ï¼šç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—
- **å¯æµ‹è¯•æ€§**ï¼šæ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•

### 1.2 æ¨¡å—ä¾èµ–å›¾

```mermaid
graph TB
    CLI[CLIæ¨¡å—] -->|è°ƒç”¨| App[Applicationå±‚]

    App -->|ç¼–æ’| Templates[Templatesæ¨¡å—]
    App -->|ç¼–æ’| Skills[Skillsæ¨¡å—]
    App -->|ç¼–æ’| Generators[Generatorsæ¨¡å—]
    App -->|ç¼–æ’| Config[Configæ¨¡å—]

    Templates -->|ä¾èµ–| Engine[TemplateEngine]
    Templates -->|ä¾èµ–| FS[FileSystem]

    Generators -->|ä¾èµ–| Collector[DocumentCollector]
    Generators -->|ä¾èµ–| Renderer[MermaidRenderer]
    Generators -->|ä¾èµ–| FS

    Skills -->|ä¾èµ–| FS
    Config -->|ä¾èµ–| FS

    Engine -->|ä½¿ç”¨| Handlebars[Handlebarsåº“]
    Renderer -->|ä½¿ç”¨| MermaidCLI[@mermaid-js/mermaid-cli]
    FS -->|ä½¿ç”¨| FSExtra[fs-extraåº“]

    style CLI fill:#e1f5ff
    style App fill:#fff4e1
    style Templates fill:#d4f1d4
    style Skills fill:#d4f1d4
    style Generators fill:#d4f1d4
    style Config fill:#d4f1d4
    style Engine fill:#ffe4e1
    style Collector fill:#ffe4e1
    style Renderer fill:#ffe4e1
    style FS fill:#ffe4e1
```

---

## 2. CLIæ¨¡å—

### 2.1 èŒè´£
- å‘½ä»¤è¡Œå‚æ•°è§£æ
- ç”¨æˆ·äº¤äº’ï¼ˆé—®ç­”å¼é…ç½®ï¼‰
- å‘½ä»¤è·¯ç”±åˆ†å‘
- é”™è¯¯å¤„ç†ä¸å‹å¥½æç¤º

### 2.2 ç›®å½•ç»“æ„

```
src/cli/
â”œâ”€â”€ index.ts              # CLIå…¥å£ï¼Œæ³¨å†Œå‘½ä»¤
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ init.ts           # initå‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ generate-prd.ts   # generate-prdå‘½ä»¤
â”‚   â””â”€â”€ validate.ts       # validateå‘½ä»¤
â”œâ”€â”€ prompts/
â”‚   â”œâ”€â”€ projectType.ts    # é¡¹ç›®ç±»å‹é€‰æ‹©
â”‚   â”œâ”€â”€ projectName.ts    # é¡¹ç›®åç§°è¾“å…¥
â”‚   â””â”€â”€ customization.ts  # è‡ªå®šä¹‰é…ç½®
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ spinner.ts        # è¿›åº¦åŠ è½½åŠ¨ç”»
â”‚   â”œâ”€â”€ logger.ts         # æ—¥å¿—è¾“å‡º
â”‚   â””â”€â”€ formatter.ts      # è¾“å‡ºæ ¼å¼åŒ–
â””â”€â”€ types.ts              # CLIç±»å‹å®šä¹‰
```

### 2.3 æ ¸å¿ƒæ¥å£

```typescript
// src/cli/types.ts

export interface Command {
  name: string;
  description: string;
  options: CommandOption[];
  execute(args: CommandArgs): Promise<CommandResult>;
}

export interface CommandOption {
  flags: string;
  description: string;
  defaultValue?: any;
}

export interface CommandArgs {
  [key: string]: any;
}

export interface CommandResult {
  success: boolean;
  message?: string;
  data?: any;
  error?: Error;
}
```

### 2.4 initå‘½ä»¤å®ç°

```typescript
// src/cli/commands/init.ts

import { Command, program } from 'commander';
import prompts from 'prompts';
import { InitWorkflow } from '@/application/workflows';
import { Logger, Spinner } from '../ui';

export async function initCommand(
  projectName?: string,
  options?: InitOptions
): Promise<void> {
  const logger = new Logger();
  const spinner = new Spinner();

  try {
    // 1. è·å–é¡¹ç›®é…ç½®ï¼ˆäº¤äº’å¼æˆ–å‘½ä»¤è¡Œå‚æ•°ï¼‰
    const config = await getProjectConfig(projectName, options);

    // 2. æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œæµ
    spinner.start('æ­£åœ¨åˆ›å»ºé¡¹ç›®...');
    const workflow = new InitWorkflow();
    const result = await workflow.execute(config);

    // 3. æ˜¾ç¤ºç»“æœ
    if (result.success) {
      spinner.succeed('âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸï¼');
      logger.success(`\nğŸ“ é¡¹ç›®è·¯å¾„: ${result.projectPath}`);
      logger.info(`\nğŸ“– ä¸‹ä¸€æ­¥:`);
      logger.info(`  cd ${config.projectName}`);
      logger.info(`  å¼€å§‹ä½¿ç”¨ Claude Code è¿›è¡Œå¼€å‘`);
    } else {
      spinner.fail('âŒ é¡¹ç›®åˆ›å»ºå¤±è´¥');
      logger.error(result.error?.message || 'æœªçŸ¥é”™è¯¯');
    }
  } catch (error) {
    spinner.fail('âŒ å‘ç”Ÿé”™è¯¯');
    logger.error(error);
    process.exit(1);
  }
}

async function getProjectConfig(
  projectName?: string,
  options?: InitOptions
): Promise<ProjectConfig> {
  // äº¤äº’å¼æ¨¡å¼
  if (!options?.nonInteractive) {
    const response = await prompts([
      {
        type: projectName ? null : 'text',
        name: 'projectName',
        message: 'é¡¹ç›®åç§°',
        initial: 'my-app',
        validate: (value) => /^[a-z0-9-]+$/.test(value) || 'ä»…æ”¯æŒå°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦'
      },
      {
        type: 'select',
        name: 'projectType',
        message: 'é€‰æ‹©é¡¹ç›®ç±»å‹',
        choices: [
          { title: 'Webå…¨æ ˆåº”ç”¨ (React/Vue + Node.js)', value: 'web-fullstack' },
          { title: 'ç§»åŠ¨åº”ç”¨ (React Native / Flutter)', value: 'mobile-app' },
          { title: 'åç«¯API (Node.js / Python)', value: 'backend-api' },
          { title: 'CLIå·¥å…· (Node.js / Go)', value: 'cli-tool' }
        ]
      }
    ]);

    return {
      projectName: projectName || response.projectName,
      projectType: response.projectType,
      skipGit: options?.skipGit || false,
      skipInstall: options?.skipInstall || false
    };
  }

  // éäº¤äº’å¼æ¨¡å¼
  return {
    projectName: projectName || 'my-app',
    projectType: options.type || 'web-fullstack',
    skipGit: options.skipGit || false,
    skipInstall: options.skipInstall || false
  };
}
```

---

## 3. Applicationå±‚ï¼ˆå·¥ä½œæµç¼–æ’ï¼‰

### 3.1 èŒè´£
- ç¼–æ’å¤šæ¨¡å—åä½œ
- ç®¡ç†ä¸šåŠ¡æµç¨‹
- é”™è¯¯å¤„ç†å’Œå›æ»š
- è¿›åº¦è·Ÿè¸ª

### 3.2 ç›®å½•ç»“æ„

```
src/application/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ InitWorkflow.ts       # åˆå§‹åŒ–å·¥ä½œæµ
â”‚   â”œâ”€â”€ GeneratePRDWorkflow.ts # PRDç”Ÿæˆå·¥ä½œæµ
â”‚   â””â”€â”€ ValidateWorkflow.ts    # éªŒè¯å·¥ä½œæµ
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ProgressTracker.ts    # è¿›åº¦è·Ÿè¸ª
â”‚   â””â”€â”€ ErrorHandler.ts       # é”™è¯¯å¤„ç†
â””â”€â”€ types.ts                  # åº”ç”¨å±‚ç±»å‹
```

### 3.3 InitWorkflowå®ç°

```typescript
// src/application/workflows/InitWorkflow.ts

import { TemplateApplicator } from '@/templates';
import { SkillManager } from '@/skills';
import { ConfigManager } from '@/config';
import { FileSystemHelper, GitHelper } from '@/infrastructure';

export class InitWorkflow {
  constructor(
    private templateApplicator = new TemplateApplicator(),
    private skillManager = new SkillManager(),
    private configManager = new ConfigManager(),
    private fs = new FileSystemHelper(),
    private git = new GitHelper()
  ) {}

  async execute(config: ProjectConfig): Promise<InitResult> {
    const startTime = Date.now();
    const projectPath = path.resolve(process.cwd(), config.projectName);

    try {
      // 1. æ£€æŸ¥ç›®å½•æ˜¯å¦å·²å­˜åœ¨
      if (await this.fs.exists(projectPath)) {
        throw new Error(`ç›®å½•å·²å­˜åœ¨: ${projectPath}`);
      }

      // 2. åˆ›å»ºé¡¹ç›®ç›®å½•
      await this.fs.ensureDir(projectPath);

      // 3. åº”ç”¨æ¨¡æ¿
      const template = this.templateApplicator.getTemplate(config.projectType);
      await this.templateApplicator.apply(template, projectPath);

      // 4. å¤åˆ¶Skills
      await this.skillManager.copyToProject(projectPath);

      // 5. å¤åˆ¶CLAUDE.md
      await this.fs.copy(
        path.join(__dirname, '../../assets/CLAUDE.md'),
        path.join(projectPath, 'CLAUDE.md')
      );

      // 6. ç”Ÿæˆé…ç½®æ–‡ä»¶
      const projectConfig = this.configManager.createConfig(config);
      await this.configManager.save(projectConfig, projectPath);

      // 7. åˆå§‹åŒ–Gitï¼ˆå¯é€‰ï¼‰
      if (!config.skipGit) {
        await this.git.init(projectPath);
        await this.git.add(projectPath, ['.']);
        await this.git.commit(projectPath, 'Initial commit from ai-dev template');
      }

      // 8. è¿”å›ç»“æœ
      return {
        success: true,
        projectPath,
        duration: Date.now() - startTime,
        files: await this.fs.listFiles(projectPath)
      };

    } catch (error) {
      // æ¸…ç†å¤±è´¥çš„é¡¹ç›®
      if (await this.fs.exists(projectPath)) {
        await this.fs.remove(projectPath);
      }
      throw error;
    }
  }
}
```

---

## 4. Templatesæ¨¡å—

### 4.1 èŒè´£
- ç®¡ç†é¡¹ç›®æ¨¡æ¿
- æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“
- æ¨¡æ¿éªŒè¯

### 4.2 ç›®å½•ç»“æ„

```
src/templates/
â”œâ”€â”€ index.ts              # æ¨¡å—å…¥å£
â”œâ”€â”€ registry/
â”‚   â”œâ”€â”€ TemplateRegistry.ts    # æ¨¡æ¿æ³¨å†Œä¸­å¿ƒ
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ WebFullstackTemplate.ts
â”‚   â”‚   â”œâ”€â”€ MobileAppTemplate.ts
â”‚   â”‚   â”œâ”€â”€ BackendApiTemplate.ts
â”‚   â”‚   â””â”€â”€ CliToolTemplate.ts
â”œâ”€â”€ engine/
â”‚   â”œâ”€â”€ TemplateEngine.ts      # æ¨¡æ¿å¼•æ“
â”‚   â”œâ”€â”€ TemplateApplicator.ts  # æ¨¡æ¿åº”ç”¨å™¨
â”‚   â””â”€â”€ FileGenerator.ts       # æ–‡ä»¶ç”Ÿæˆå™¨
â”œâ”€â”€ assets/                    # æ¨¡æ¿èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ web-fullstack/
â”‚       â”œâ”€â”€ mobile-app/
â”‚       â”œâ”€â”€ backend-api/
â”‚       â””â”€â”€ cli-tool/
â””â”€â”€ types.ts
```

### 4.3 æ ¸å¿ƒæ¥å£

```typescript
// src/templates/types.ts

export interface Template {
  id: string;
  type: ProjectType;
  name: string;
  description: string;
  version: string;
  files: TemplateFile[];
  directories: string[];
  scripts: PackageScripts;
}

export interface TemplateFile {
  path: string;                    // ç›¸å¯¹è·¯å¾„
  content: string | TemplateContent;
  encoding: BufferEncoding;
  isTemplate: boolean;              // æ˜¯å¦éœ€è¦Handlebarsæ¸²æŸ“
}

export interface TemplateContent {
  template: string;                 // Handlebarsæ¨¡æ¿å­—ç¬¦ä¸²
  data: Record<string, any>;        // æ¨¡æ¿æ•°æ®
}

export type ProjectType =
  | 'web-fullstack'
  | 'mobile-app'
  | 'backend-api'
  | 'cli-tool';
```

### 4.4 TemplateRegistryå®ç°

```typescript
// src/templates/registry/TemplateRegistry.ts

import { Template, ProjectType } from '../types';
import { WebFullstackTemplate } from './templates/WebFullstackTemplate';
import { MobileAppTemplate } from './templates/MobileAppTemplate';
import { BackendApiTemplate } from './templates/BackendApiTemplate';
import { CliToolTemplate } from './templates/CliToolTemplate';

export class TemplateRegistry {
  private templates: Map<ProjectType, Template> = new Map();

  constructor() {
    this.registerDefaults();
  }

  private registerDefaults(): void {
    this.register(new WebFullstackTemplate());
    this.register(new MobileAppTemplate());
    this.register(new BackendApiTemplate());
    this.register(new CliToolTemplate());
  }

  register(template: Template): void {
    this.templates.set(template.type, template);
  }

  getByType(type: ProjectType): Template | undefined {
    return this.templates.get(type);
  }

  getAll(): Template[] {
    return Array.from(this.templates.values());
  }

  has(type: ProjectType): boolean {
    return this.templates.has(type);
  }
}
```

### 4.5 TemplateApplicatorå®ç°

```typescript
// src/templates/engine/TemplateApplicator.ts

import { Template } from '../types';
import { TemplateEngine } from './TemplateEngine';
import { FileGenerator } from './FileGenerator';

export class TemplateApplicator {
  constructor(
    private engine = new TemplateEngine(),
    private fileGenerator = new FileGenerator()
  ) {}

  async apply(template: Template, targetPath: string): Promise<void> {
    // 1. åˆ›å»ºç›®å½•ç»“æ„
    await this.createDirectories(template, targetPath);

    // 2. ç”Ÿæˆæ–‡ä»¶
    await this.generateFiles(template, targetPath);

    // 3. ç”Ÿæˆpackage.json
    await this.generatePackageJson(template, targetPath);
  }

  private async createDirectories(template: Template, targetPath: string): Promise<void> {
    for (const dir of template.directories) {
      await this.fileGenerator.ensureDir(path.join(targetPath, dir));
    }
  }

  private async generateFiles(template: Template, targetPath: string): Promise<void> {
    for (const file of template.files) {
      const filePath = path.join(targetPath, file.path);

      if (file.isTemplate && typeof file.content !== 'string') {
        // æ¸²æŸ“Handlebarsæ¨¡æ¿
        const content = this.engine.render(file.content.template, file.content.data);
        await this.fileGenerator.writeFile(filePath, content, file.encoding);
      } else {
        // ç›´æ¥å†™å…¥
        await this.fileGenerator.writeFile(filePath, file.content as string, file.encoding);
      }
    }
  }

  private async generatePackageJson(template: Template, targetPath: string): Promise<void> {
    const packageJson = {
      name: path.basename(targetPath),
      version: '0.1.0',
      description: template.description,
      scripts: template.scripts,
      // ... å…¶ä»–å­—æ®µ
    };

    await this.fileGenerator.writeJson(
      path.join(targetPath, 'package.json'),
      packageJson
    );
  }
}
```

---

## 5. Skillsæ¨¡å—

### 5.1 èŒè´£
- åŠ è½½Skillsæ–‡ä»¶
- å¤åˆ¶Skillsåˆ°é¡¹ç›®
- SkillséªŒè¯

### 5.2 ç›®å½•ç»“æ„

```
src/skills/
â”œâ”€â”€ index.ts              # æ¨¡å—å…¥å£
â”œâ”€â”€ SkillManager.ts       # Skillsç®¡ç†å™¨
â”œâ”€â”€ SkillLoader.ts        # åŠ è½½å™¨
â”œâ”€â”€ SkillCopier.ts        # å¤åˆ¶å™¨
â”œâ”€â”€ assets/               # Skillsèµ„æº
â”‚   â””â”€â”€ skills/
â”‚       â”œâ”€â”€ requirements-analyzer.md
â”‚       â”œâ”€â”€ architecture-designer.md
â”‚       â”œâ”€â”€ developer-guide.md
â”‚       â””â”€â”€ test-planner.md
â””â”€â”€ types.ts
```

### 5.3 æ ¸å¿ƒæ¥å£

```typescript
// src/skills/types.ts

export interface Skill {
  name: string;
  fileName: string;
  content: string;
  description: string;
}

export interface SkillManager {
  loadAll(): Promise<Skill[]>;
  copyToProject(projectPath: string): Promise<void>;
  validate(skill: Skill): boolean;
}
```

### 5.4 SkillManagerå®ç°

```typescript
// src/skills/SkillManager.ts

import { Skill } from './types';
import { SkillLoader } from './SkillLoader';
import { SkillCopier } from './SkillCopier';

export class SkillManager {
  private skills: Skill[] = [];

  constructor(
    private loader = new SkillLoader(),
    private copier = new SkillCopier()
  ) {}

  async loadAll(): Promise<Skill[]> {
    if (this.skills.length === 0) {
      this.skills = await this.loader.loadFromAssets();
    }
    return this.skills;
  }

  async copyToProject(projectPath: string): Promise<void> {
    const skills = await this.loadAll();
    await this.copier.copy(skills, projectPath);
  }

  validate(skill: Skill): boolean {
    return (
      skill.name?.length > 0 &&
      skill.fileName?.length > 0 &&
      skill.content?.length > 0
    );
  }
}
```

---

## 6. Generatorsæ¨¡å—ï¼ˆPRDç”Ÿæˆï¼‰

### 6.1 èŒè´£
- æ”¶é›†éœ€æ±‚æ–‡æ¡£æ•°æ®
- AIåˆ†æä¸šåŠ¡å®ä½“
- æ¸²æŸ“Mermaidå›¾è¡¨
- ç»„è£…PRDæ–‡æ¡£

### 6.2 ç›®å½•ç»“æ„

```
src/generators/
â”œâ”€â”€ index.ts              # æ¨¡å—å…¥å£
â”œâ”€â”€ prd/
â”‚   â”œâ”€â”€ PRDGenerator.ts        # PRDç”Ÿæˆå™¨ä¸»ç±»
â”‚   â”œâ”€â”€ DocumentCollector.ts   # æ–‡æ¡£æ”¶é›†å™¨
â”‚   â”œâ”€â”€ EntityAnalyzer.ts      # å®ä½“åˆ†æå™¨ï¼ˆAIï¼‰
â”‚   â”œâ”€â”€ MermaidRenderer.ts     # Mermaidæ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ PRDComposer.ts         # PRDç»„è£…å™¨
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ prd-template.hbs   # PRD Handlebarsæ¨¡æ¿
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ markdownParser.ts      # Markdownè§£æ
â”‚   â”œâ”€â”€ mermaidExtractor.ts    # Mermaidæå–å™¨
â”‚   â””â”€â”€ imageProcessor.ts      # å›¾ç‰‡å¤„ç†
â””â”€â”€ types.ts
```

### 6.3 æ ¸å¿ƒæ¥å£

```typescript
// src/generators/types.ts

export interface DocumentData {
  projectOverview: string;
  moduleDivision: ModuleInfo[];
  userStories: UserStory[];
  modules: ModuleDetail[];
}

export interface ModuleDetail {
  name: string;
  coreFlow: string;
  acceptanceCriteria: string;
  prototype?: string;
}

export interface BusinessEntities {
  entities: BusinessEntity[];
  relationships: EntityRelationship[];
}

export interface BusinessEntity {
  name: string;
  displayName: string;
  attributes: EntityAttribute[];
}

export interface EntityAttribute {
  name: string;
  type: string;
  constraints: string[];
  description?: string;
}

export interface EntityRelationship {
  from: string;
  to: string;
  type: '1:1' | '1:N' | 'N:M';
  description: string;
}

export interface RenderedDiagrams {
  businessEntityDiagram: DiagramResult;
  flowDiagrams: DiagramResult[];
}

export interface DiagramResult {
  type: string;
  mermaidCode: string;
  imagePath: string;
  success: boolean;
  error?: string;
}
```

### 6.4 PRDGeneratorå®ç°

```typescript
// src/generators/prd/PRDGenerator.ts

import { DocumentCollector } from './DocumentCollector';
import { EntityAnalyzer } from './EntityAnalyzer';
import { MermaidRenderer } from './MermaidRenderer';
import { PRDComposer } from './PRDComposer';

export class PRDGenerator {
  constructor(
    private collector = new DocumentCollector(),
    private analyzer = new EntityAnalyzer(),
    private renderer = new MermaidRenderer(),
    private composer = new PRDComposer()
  ) {}

  async generate(options?: GeneratePRDOptions): Promise<GeneratePRDResult> {
    const startTime = Date.now();

    try {
      // 1. æ”¶é›†éœ€æ±‚æ•°æ®
      console.log('ğŸ” æ­£åœ¨æ”¶é›†éœ€æ±‚æ–‡æ¡£...');
      const data = await this.collector.collect();
      console.log(`âœ“ å·²æ”¶é›† ${this.countDocuments(data)} ä¸ªæ–‡æ¡£`);

      // 2. AIåˆ†æä¸šåŠ¡å®ä½“
      console.log('\nğŸ¤– AI æ­£åœ¨åˆ†æä¸šåŠ¡å®ä½“...');
      const entities = await this.analyzer.analyze(data);
      console.log(`âœ“ è¯†åˆ«åˆ° ${entities.entities.length} ä¸ªæ ¸å¿ƒå®ä½“`);

      // 3. ç”ŸæˆMermaidä»£ç 
      const mermaidCode = this.analyzer.generateMermaidER(entities);

      // 4. æ¸²æŸ“å›¾è¡¨
      console.log('\nğŸ¨ æ­£åœ¨æ¸²æŸ“å›¾è¡¨...');
      const diagrams = await this.renderer.renderAll({
        businessEntityDiagram: mermaidCode,
        flowDiagrams: data.modules.map(m => m.coreFlow)
      });

      // 5. ç»„è£…PRD
      console.log('\nğŸ“ æ­£åœ¨ç”Ÿæˆ PRD.md...');
      const prdPath = await this.composer.compose(data, entities, diagrams, options);

      console.log('âœ“ PRD ç”Ÿæˆå®Œæˆï¼\n');

      return {
        success: true,
        prdPath,
        diagrams: diagrams.businessEntityDiagram ? [diagrams.businessEntityDiagram, ...diagrams.flowDiagrams] : diagrams.flowDiagrams,
        duration: Date.now() - startTime
      };

    } catch (error) {
      return {
        success: false,
        error: error as Error,
        duration: Date.now() - startTime
      };
    }
  }

  private countDocuments(data: DocumentData): number {
    return 3 + data.modules.length * 2; // 00, 01, 02 + æ¯æ¨¡å—2ä¸ªæ–‡æ¡£
  }
}
```

---

## 7. Configæ¨¡å—

### 7.1 èŒè´£
- åŠ è½½/ä¿å­˜é¡¹ç›®é…ç½®
- é…ç½®éªŒè¯
- é»˜è®¤é…ç½®ç”Ÿæˆ

### 7.2 ç›®å½•ç»“æ„

```
src/config/
â”œâ”€â”€ index.ts              # æ¨¡å—å…¥å£
â”œâ”€â”€ ConfigManager.ts      # é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ ConfigValidator.ts    # é…ç½®éªŒè¯å™¨
â”œâ”€â”€ schema.ts             # é…ç½®Schema
â””â”€â”€ types.ts
```

### 7.3 æ ¸å¿ƒæ¥å£

```typescript
// src/config/types.ts

export interface ProjectConfig {
  version: string;
  projectType: ProjectType;
  projectName: string;
  description: string;
  author: string;
  createdAt: Date;
  metadata: ConfigMetadata;
}

export interface ConfigMetadata {
  templateVersion: string;
  claudeVersion: string;
  skills: string[];
  customSettings?: Record<string, any>;
}
```

### 7.4 ConfigManagerå®ç°

```typescript
// src/config/ConfigManager.ts

import { ProjectConfig } from './types';
import { ConfigValidator } from './ConfigValidator';
import { FileSystemHelper } from '@/infrastructure';

export class ConfigManager {
  private configFileName = '.ai-dev.json';

  constructor(
    private validator = new ConfigValidator(),
    private fs = new FileSystemHelper()
  ) {}

  async load(projectPath: string): Promise<ProjectConfig> {
    const configPath = path.join(projectPath, this.configFileName);

    if (!await this.fs.exists(configPath)) {
      throw new Error('é…ç½®æ–‡ä»¶ä¸å­˜åœ¨');
    }

    const data = await this.fs.readJson(configPath);
    const validation = this.validator.validate(data);

    if (!validation.valid) {
      throw new Error(`é…ç½®æ–‡ä»¶æ— æ•ˆ: ${validation.errors.join(', ')}`);
    }

    return data as ProjectConfig;
  }

  async save(config: ProjectConfig, projectPath: string): Promise<void> {
    const validation = this.validator.validate(config);

    if (!validation.valid) {
      throw new Error(`é…ç½®æ— æ•ˆ: ${validation.errors.join(', ')}`);
    }

    const configPath = path.join(projectPath, this.configFileName);
    await this.fs.writeJson(configPath, config, { spaces: 2 });
  }

  createConfig(options: Partial<ProjectConfig>): ProjectConfig {
    return {
      version: '1.0.0',
      projectType: options.projectType || 'web-fullstack',
      projectName: options.projectName || 'my-app',
      description: options.description || '',
      author: options.author || '',
      createdAt: new Date(),
      metadata: {
        templateVersion: '1.0.0',
        claudeVersion: '4.5',
        skills: [
          'requirements-analyzer',
          'architecture-designer',
          'developer-guide',
          'test-planner'
        ],
        ...options.metadata
      }
    };
  }
}
```

---

## 8. Infrastructureå±‚

### 8.1 FileSystemHelper

```typescript
// src/infrastructure/FileSystemHelper.ts

import fs from 'fs-extra';
import path from 'path';

export class FileSystemHelper {
  async ensureDir(dirPath: string): Promise<void> {
    await fs.ensureDir(dirPath);
  }

  async copy(src: string, dest: string, options?: fs.CopyOptions): Promise<void> {
    await fs.copy(src, dest, options);
  }

  async writeFile(filePath: string, content: string, encoding: BufferEncoding = 'utf8'): Promise<void> {
    await fs.outputFile(filePath, content, encoding);
  }

  async readFile(filePath: string, encoding: BufferEncoding = 'utf8'): Promise<string> {
    return await fs.readFile(filePath, encoding);
  }

  async writeJson(filePath: string, data: any, options?: fs.WriteOptions): Promise<void> {
    await fs.writeJson(filePath, data, options);
  }

  async readJson(filePath: string): Promise<any> {
    return await fs.readJson(filePath);
  }

  async exists(path: string): Promise<boolean> {
    return await fs.pathExists(path);
  }

  async remove(path: string): Promise<void> {
    await fs.remove(path);
  }

  async listFiles(dirPath: string): Promise<string[]> {
    const files: string[] = [];

    async function walk(dir: string) {
      const entries = await fs.readdir(dir, { withFileTypes: true });

      for (const entry of entries) {
        const fullPath = path.join(dir, entry.name);
        if (entry.isDirectory()) {
          await walk(fullPath);
        } else {
          files.push(fullPath);
        }
      }
    }

    await walk(dirPath);
    return files;
  }
}
```

---

## 9. æ¨¡å—é—´é€šä¿¡

### 9.1 é€šä¿¡æ–¹å¼
- **åŒæ­¥è°ƒç”¨**ï¼šæ¨¡å—é—´ç›´æ¥importï¼ˆç¼–è¯‘æ—¶ä¾èµ–ï¼‰
- **æ¥å£å¥‘çº¦**ï¼šé€šè¿‡TypeScriptæ¥å£å®šä¹‰å¥‘çº¦
- **ä¾èµ–æ³¨å…¥**ï¼šæ„é€ å‡½æ•°æ³¨å…¥ï¼ˆä¾¿äºæµ‹è¯•ï¼‰

### 9.2 é”™è¯¯ä¼ æ’­
- ä½¿ç”¨æ ‡å‡†Errorå¯¹è±¡
- è‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼ˆå¦‚ValidationErrorã€FileSystemErrorï¼‰
- é”™è¯¯ä¿¡æ¯åŒ…å«ä¸Šä¸‹æ–‡

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•
- æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æµ‹è¯•
- Mockå¤–éƒ¨ä¾èµ–
- è¦†ç›–ç‡ > 80%

### 10.2 é›†æˆæµ‹è¯•
- æµ‹è¯•æ¨¡å—é—´åä½œ
- æµ‹è¯•å®Œæ•´å·¥ä½œæµï¼ˆInitWorkflowã€PRDGeneratorWorkflowï¼‰

### 10.3 E2Eæµ‹è¯•
- æµ‹è¯•å®Œæ•´ç”¨æˆ·åœºæ™¯
- åœ¨ä¸´æ—¶ç›®å½•æ‰§è¡ŒçœŸå®å‘½ä»¤

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-12-10
**ç»´æŠ¤è€…**: Architecture Designer Skill
